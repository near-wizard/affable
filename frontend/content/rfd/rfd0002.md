---
number: 2
title: "RFD 2: Deep Linking Without Next.js Router"
state: discussing
discussion: https://github.com/near-wizard/affable/discussions/18
authors:
  - Jared Butler
date: 2025-10-05
labels:
  - frontend
  - architecture
---

# RFD 2: Deep Linking Without Next.js Router

## Problem Statement

My first problem, I am talking in the royal we and our... it is just me working on this up to this point. If you'd like to help out, feel free to fork and mess around. If you can figure out how to fix this routing issue and get the same/similar design with the deep linked routing to the modal windows AND be SEO friendly by having content on first load... I'll buy you a coffee and either hire you or help you get a job (I got those FAANG, Microsoft, Expedia, VC/IB connections, so I can probably make that happen. All bets are off I have to solve it first (but I am starting my backend sprint rn with sporadic frontend to add new pages or fun lil gimmicks bc I can't stay away and this is primarily a fun project for me to fall back in love with building stuff again after a burnt out  period at said FAANGMULLA and Consulting companies)

Aside from the Asides -- This is really how I talk, which is why I'm pissed ChatGPT uses em-dashes. They were my favorite punctuation and I've been using them since middle school (before the 2010's) and now I have to do double hyphen to be different. Rant over, into tech:

Our [Windows 95-style desktop UI](https://affablelink.com) (click me, I'm fun) needs deep linking for SEO and shareability, but Next.js router's navigation lifecycle conflicts with our client-side window management state. It's a classic issue of git gud, but sometimes momentum feels better than actually solving the problem. If this were my DB, I'd hunker down and figure it out the right way. But this is UI. More forgiving, and will probably be completely revamped in like 2 years if I'm still maintaining this project then (I do hope to be as of now).

## Background

We're building a retro desktop interface where "windows" are React components managed entirely in client-side state. When a user clicks an icon, we want to:

1. Open a window with smooth animations
2. Update the URL for sharing (e.g., `/about`)
3. Enable search engines to crawl each "window" as a page
4. NOT trigger full page re-renders

## Attempted Solutions

### Attempt 1: Shallow Routing
Used `router.push(url, { shallow: true })` but this still triggered component re-renders that reset our window state.

### Attempt 2: router.replace with setTimeout
Tried debouncing the router call in case it was race conditions. Also debouncing makes me feel like an electrical engineer because that was how we fixed any problems when coding user interactions directly on boards in the world of meat-bags.

### Attempt 3: useRef to prevent re-initialization
Helped but didn't solve the core issue of router-triggered re-renders.

## Proposed Solution

Use `window.history.replaceState()` directly instead of Next.js router for client-side navigation.

```typescript
const openWindow = (type: string) => {
  setWindows(prev => [...prev, newWindow])
  window.history.replaceState({}, '', `/${type}`)
}
```

## Why This Works

- **No framework overhead**: Direct browser API doesn't trigger Next.js lifecycle
- **SEO preserved**: Initial page load still uses Next.js SSR with proper metadata
- **Deep linking works**: URLs are real and shareable
- **State is stable**: No unexpected re-renders

## Trade-offs

**Pros:**
- Simpler code
- Predictable behavior
- Better performance (no router overhead)

**Cons:**
- Can't use Next.js router features (prefetching, middleware)
- Have to manually manage history state
- Diverges from "Next.js way" and I don't want to deal with that hate mail -- also, if this becomes big, maintainability, readability, and judgement from my team (lol if i care).

## Decision


This works... well enough for our MVP use case (deep link shareability) but still lacks that SEO since the pages aren't available on first render. Yes, I am a `use client` addict (side effect of working at Facebook when the code base was older class components but you start adopting FC and hooks and intermingling them -- I am a hooks addict which I guess forces me to be a `use client` addict in the Next.js world), but I can stop whenever I want to. We're building an SPA-like experience where, for much of the app, the router's features aren't needed. Sometimes the best framework solution is no framework. Hehehehe totally not copium.

Still, open to hearing better ways I can improve this. At some point, I may try to see how I can break this up and do [ISR](https://vercel.com/docs/incremental-static-regeneration) or some other means to be more bot and crawlable since nearly all of my deep linked modals should effectively be a "static page" in a container with interactivity... so here's to hoping.

This is a cry for help.

## See Also

- Blog post: ["Windows 95 Meets Next.js: A Deep Linking Adventure Through Router Hell"](https://showerthoughtseng.substack.com/p/building-a-windows95-like-spa-with?r=nnwqj) This was written at a point where I thought I had solved the problems... I was still a couple days tinkering to get to my current solution at time of posting... and even that I hope to improve.